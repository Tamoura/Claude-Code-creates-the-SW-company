# New Product Workflow Task Graph Template
# Placeholders: {PRODUCT}, {DESCRIPTION}

metadata:
  product: "{PRODUCT}"
  version: "1.0.0"
  workflow_type: "new-product"
  created_at: "{TIMESTAMP}"
  updated_at: "{TIMESTAMP}"

tasks:
  # ============================================================================
  # PHASE 1: INCEPTION & PLANNING
  # ============================================================================

  - id: "PRD-01"
    name: "Create Product Requirements Document"
    description: |
      Analyze CEO brief: {DESCRIPTION}
      Create comprehensive PRD with:
      - User personas and stories
      - Core features and MVP scope
      - Success metrics
      - Technical constraints
      - Create product addendum (.claude/addendum.md)
    agent: "product-manager"
    depends_on: []
    produces:
      - name: "PRD"
        type: "document"
        path: "products/{PRODUCT}/docs/PRD.md"
      - name: "Product Addendum"
        type: "document"
        path: "products/{PRODUCT}/.claude/addendum.md"
    parallel_ok: false
    checkpoint: true
    priority: "critical"
    estimated_time_minutes: 120
    acceptance_criteria:
      - "PRD follows template structure"
      - "All user stories have acceptance criteria"
      - "Success metrics are measurable"
      - "MVP scope is clearly defined"
      - "Product addendum created with tech stack and conventions"
    status: "pending"

  # ============================================================================
  # PHASE 2: ARCHITECTURE
  # ============================================================================

  - id: "ARCH-01"
    name: "Design System Architecture"
    description: |
      Create system design based on PRD:
      - API contracts and endpoints
      - Database schema (ERD)
      - Architecture decisions (ADRs)
      - Technology stack confirmation
      - Security considerations
      - Update product addendum with architecture details
    agent: "architect"
    depends_on: ["PRD-01"]
    consumes:
      - name: "PRD"
        required_from_task: "PRD-01"
      - name: "Product Addendum"
        required_from_task: "PRD-01"
    produces:
      - name: "Architecture Document"
        type: "document"
        path: "products/{PRODUCT}/docs/architecture.md"
      - name: "API Schema"
        type: "file"
        path: "products/{PRODUCT}/docs/api-schema.yml"
      - name: "Database Schema"
        type: "file"
        path: "products/{PRODUCT}/docs/db-schema.sql"
      - name: "ADRs"
        type: "directory"
        path: "products/{PRODUCT}/docs/ADRs/"
    parallel_ok: false
    checkpoint: true
    priority: "critical"
    estimated_time_minutes: 180
    acceptance_criteria:
      - "API contracts define all MVP endpoints"
      - "Database schema is normalized"
      - "At least 2 ADRs documenting key decisions"
      - "Security considerations documented"
      - "Tech stack confirmed and documented"
    status: "pending"

  # ============================================================================
  # PHASE 3: FOUNDATION (Parallel)
  # ============================================================================

  - id: "DEVOPS-01"
    name: "Setup CI/CD Pipeline"
    description: |
      Configure deployment infrastructure:
      - GitHub Actions workflows (build, test, deploy)
      - Docker configuration
      - Environment setup (dev, staging, prod)
      - Database provisioning scripts
    agent: "devops-engineer"
    depends_on: ["ARCH-01"]
    consumes:
      - name: "Architecture Document"
        required_from_task: "ARCH-01"
    produces:
      - name: "GitHub Actions Workflow"
        type: "file"
        path: ".github/workflows/{PRODUCT}-ci.yml"
      - name: "Dockerfile"
        type: "file"
        path: "products/{PRODUCT}/Dockerfile"
      - name: "Docker Compose"
        type: "file"
        path: "products/{PRODUCT}/docker-compose.yml"
    parallel_ok: true
    checkpoint: false
    priority: "high"
    estimated_time_minutes: 90
    acceptance_criteria:
      - "CI workflow runs on PR"
      - "Docker build succeeds"
      - "Environment variables documented"
    status: "pending"

  - id: "BACKEND-01"
    name: "Implement Backend Foundation"
    description: |
      Setup backend API foundation:
      - Fastify application structure
      - Prisma ORM setup with schema
      - Database migrations
      - Basic middleware (logging, cors, error handling)
      - Health check endpoint
      - Unit test setup with Jest
    agent: "backend-engineer"
    depends_on: ["ARCH-01"]
    consumes:
      - name: "API Schema"
        required_from_task: "ARCH-01"
      - name: "Database Schema"
        required_from_task: "ARCH-01"
    produces:
      - name: "Backend App"
        type: "directory"
        path: "products/{PRODUCT}/apps/api"
      - name: "Prisma Schema"
        type: "file"
        path: "products/{PRODUCT}/apps/api/prisma/schema.prisma"
      - name: "Unit Tests"
        type: "directory"
        path: "products/{PRODUCT}/apps/api/tests"
    parallel_ok: true
    checkpoint: false
    priority: "high"
    estimated_time_minutes: 150
    acceptance_criteria:
      - "Fastify server starts successfully"
      - "Database connection works"
      - "Health check endpoint returns 200"
      - "At least 10 unit tests passing"
      - "Test coverage > 80%"
    status: "pending"

  - id: "FRONTEND-01"
    name: "Implement Frontend Foundation"
    description: |
      Setup frontend application foundation:
      - Next.js 14+ app with App Router
      - Tailwind CSS configuration
      - Layout components (header, footer, navigation)
      - Routing structure
      - Basic pages (home, 404, error)
      - Unit test setup with React Testing Library
    agent: "frontend-engineer"
    depends_on: ["ARCH-01"]
    consumes:
      - name: "Architecture Document"
        required_from_task: "ARCH-01"
    produces:
      - name: "Frontend App"
        type: "directory"
        path: "products/{PRODUCT}/apps/web"
      - name: "Layout Components"
        type: "directory"
        path: "products/{PRODUCT}/apps/web/src/components/layout"
      - name: "Unit Tests"
        type: "directory"
        path: "products/{PRODUCT}/apps/web/tests"
    parallel_ok: true
    checkpoint: false
    priority: "high"
    estimated_time_minutes: 120
    acceptance_criteria:
      - "Next.js dev server starts on port 3100+"
      - "Home page renders without errors"
      - "Tailwind CSS styles apply correctly"
      - "Layout is responsive"
      - "At least 5 component tests passing"
    status: "pending"

  # ============================================================================
  # PHASE 4: INTEGRATION & TESTING
  # ============================================================================

  - id: "QA-01"
    name: "Setup E2E Test Framework"
    description: |
      Configure end-to-end testing infrastructure:
      - Playwright configuration
      - Test utilities and helpers
      - Page Object Models
      - Database seeding for tests
      - Basic smoke tests
    agent: "qa-engineer"
    depends_on: ["FRONTEND-01"]
    consumes:
      - name: "Frontend App"
        required_from_task: "FRONTEND-01"
    produces:
      - name: "E2E Test Setup"
        type: "directory"
        path: "products/{PRODUCT}/e2e"
      - name: "Playwright Config"
        type: "file"
        path: "products/{PRODUCT}/e2e/playwright.config.ts"
      - name: "Smoke Tests"
        type: "directory"
        path: "products/{PRODUCT}/e2e/tests/smoke"
    parallel_ok: false
    checkpoint: false
    priority: "high"
    estimated_time_minutes: 60
    acceptance_criteria:
      - "Playwright installed and configured"
      - "At least 3 smoke tests created"
      - "Tests can run headless and headed"
      - "Test data seeding works"
    status: "pending"

  - id: "QA-02"
    name: "Run Testing Gate - Foundation"
    description: |
      Execute complete Testing Gate before CEO review:
      - Run all unit tests (backend + frontend)
      - Run all E2E tests
      - Start dev server and verify app loads
      - Visual verification (buttons, forms, layout)
      - Check for console errors
      - Generate test report
    agent: "qa-engineer"
    depends_on: ["BACKEND-01", "FRONTEND-01", "DEVOPS-01", "QA-01"]
    consumes:
      - name: "Backend App"
        required_from_task: "BACKEND-01"
      - name: "Frontend App"
        required_from_task: "FRONTEND-01"
    produces:
      - name: "Test Report"
        type: "document"
        path: "products/{PRODUCT}/docs/test-reports/foundation.md"
    parallel_ok: false
    checkpoint: false
    priority: "critical"
    estimated_time_minutes: 45
    acceptance_criteria:
      - "All unit tests pass (backend + frontend)"
      - "All E2E tests pass"
      - "App loads without errors on http://localhost:3100+"
      - "All UI elements visible and styled"
      - "No console errors"
    status: "pending"

  - id: "DOCS-01"
    name: "Create Initial Documentation"
    description: |
      Document the foundation:
      - README with setup instructions
      - API documentation
      - Development guide
      - Deployment guide (basic)
    agent: "technical-writer"
    depends_on: ["BACKEND-01", "FRONTEND-01", "DEVOPS-01"]
    consumes:
      - name: "Backend App"
        required_from_task: "BACKEND-01"
      - name: "Frontend App"
        required_from_task: "FRONTEND-01"
    produces:
      - name: "README"
        type: "file"
        path: "products/{PRODUCT}/README.md"
      - name: "API Docs"
        type: "file"
        path: "products/{PRODUCT}/docs/API.md"
      - name: "Development Guide"
        type: "file"
        path: "products/{PRODUCT}/docs/DEVELOPMENT.md"
    parallel_ok: true
    checkpoint: false
    priority: "normal"
    estimated_time_minutes: 60
    acceptance_criteria:
      - "README has clear setup instructions"
      - "API endpoints documented with examples"
      - "Development guide covers common tasks"
    status: "pending"

  # ============================================================================
  # CHECKPOINT: FOUNDATION COMPLETE
  # ============================================================================

  - id: "CHECKPOINT-FOUNDATION"
    name: "Foundation Complete - CEO Review"
    description: |
      Foundation is complete and tested. Ready for CEO to review:
      - Product structure in place
      - Backend API running
      - Frontend app running
      - All tests passing
      - Documentation complete

      CEO can now test the foundation before feature development begins.
    agent: "orchestrator"
    depends_on: ["QA-02", "DOCS-01"]
    parallel_ok: false
    checkpoint: true
    priority: "critical"
    estimated_time_minutes: 0
    status: "pending"

# Execution estimates:
# - Sequential time: ~900 minutes (~15 hours)
# - Parallel optimized: ~500 minutes (~8.5 hours)
# - Savings from parallelization: ~44%
