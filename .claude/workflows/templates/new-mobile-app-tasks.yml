# New Mobile App Workflow Task Graph Template
# Placeholders: {PRODUCT}, {DESCRIPTION}, {PLATFORMS}
# PLATFORMS can be: "ios", "android", or "both"

metadata:
  product: "{PRODUCT}"
  version: "1.0.0"
  workflow_type: "new-mobile-app"
  platforms: "{PLATFORMS}"
  created_at: "{TIMESTAMP}"
  updated_at: "{TIMESTAMP}"

tasks:
  # ============================================================================
  # PHASE 1: INCEPTION & PLANNING
  # ============================================================================

  - id: "PRD-01"
    name: "Create Mobile Product Requirements"
    description: |
      Analyze CEO brief: {DESCRIPTION}
      Create mobile-specific PRD with:
      - Target platforms: {PLATFORMS}
      - Mobile user personas and journeys
      - Core mobile features and MVP scope
      - Offline capabilities requirements
      - Native features needed (camera, location, notifications, etc.)
      - Success metrics
      - Create product addendum (.claude/addendum.md)
    agent: "product-manager"
    depends_on: []
    produces:
      - name: "Mobile PRD"
        type: "document"
        path: "products/{PRODUCT}/docs/PRD.md"
      - name: "Product Addendum"
        type: "document"
        path: "products/{PRODUCT}/.claude/addendum.md"
    parallel_ok: false
    checkpoint: true
    priority: "critical"
    estimated_time_minutes: 120
    acceptance_criteria:
      - "PRD addresses mobile-specific constraints (screen size, touch, offline)"
      - "Native features clearly identified"
      - "Target OS versions specified"
      - "App store requirements considered"
      - "Product addendum created with mobile tech stack"
    status: "pending"

  # ============================================================================
  # PHASE 2: DESIGN & ARCHITECTURE
  # ============================================================================

  - id: "DESIGN-01"
    name: "Create Mobile UI/UX Design"
    description: |
      Design mobile user experience:
      - Low-fidelity wireframes for all screens
      - User flow diagrams
      - Navigation structure
      - Platform-specific design patterns (iOS HIG, Material Design)
      - Interactive prototype (optional)
      - Accessibility considerations
    agent: "ui-ux-designer"
    depends_on: ["PRD-01"]
    consumes:
      - name: "Mobile PRD"
        required_from_task: "PRD-01"
    produces:
      - name: "Mobile Design System"
        type: "document"
        path: "products/{PRODUCT}/docs/design-system.md"
      - name: "Wireframes"
        type: "directory"
        path: "products/{PRODUCT}/docs/wireframes/"
    parallel_ok: false
    checkpoint: true
    priority: "critical"
    estimated_time_minutes: 180
    acceptance_criteria:
      - "All MVP screens designed"
      - "Navigation flow is intuitive"
      - "Design follows platform guidelines"
      - "Touch targets meet accessibility standards (44x44pt iOS, 48x48dp Android)"
      - "Loading and error states designed"
    status: "pending"

  - id: "ARCH-01"
    name: "Design Mobile Architecture"
    description: |
      Create mobile architecture based on PRD:
      - App navigation structure (Expo Router)
      - State management strategy (Zustand)
      - Data persistence approach (AsyncStorage, SQLite)
      - API integration design
      - Offline-first strategy (if required)
      - Push notification architecture (if required)
      - Security considerations (SecureStore for tokens)
      - ADRs for key mobile decisions
    agent: "architect"
    depends_on: ["PRD-01", "DESIGN-01"]
    consumes:
      - name: "Mobile PRD"
        required_from_task: "PRD-01"
      - name: "Mobile Design System"
        required_from_task: "DESIGN-01"
    produces:
      - name: "Mobile Architecture Document"
        type: "document"
        path: "products/{PRODUCT}/docs/architecture.md"
      - name: "ADRs"
        type: "directory"
        path: "products/{PRODUCT}/docs/ADRs/"
    parallel_ok: false
    checkpoint: true
    priority: "critical"
    estimated_time_minutes: 120
    acceptance_criteria:
      - "Navigation structure defined"
      - "State management approach documented"
      - "API integration pattern specified"
      - "At least 2 ADRs for mobile-specific decisions"
      - "Security considerations documented"
    status: "pending"

  # ============================================================================
  # PHASE 3: FOUNDATION
  # ============================================================================

  - id: "MOBILE-01"
    name: "Setup Expo App Foundation"
    description: |
      Create Expo app foundation:
      - Initialize Expo app with TypeScript
      - Configure app.json (app name, bundle ID, icons, splash)
      - Setup Expo Router file-based navigation
      - Configure NativeWind (Tailwind CSS)
      - Setup folder structure (components, hooks, lib, stores)
      - Install core dependencies (Zustand, TanStack Query, etc.)
      - Configure TypeScript strict mode
    agent: "mobile-developer"
    depends_on: ["ARCH-01"]
    consumes:
      - name: "Mobile Architecture Document"
        required_from_task: "ARCH-01"
    produces:
      - name: "Mobile App"
        type: "directory"
        path: "products/{PRODUCT}/apps/mobile"
      - name: "App Config"
        type: "file"
        path: "products/{PRODUCT}/apps/mobile/app.json"
    parallel_ok: false
    checkpoint: false
    priority: "critical"
    estimated_time_minutes: 60
    acceptance_criteria:
      - "Expo app runs on iOS simulator"
      - "Expo app runs on Android emulator"
      - "TypeScript compiles without errors"
      - "File-based routing works"
      - "Tailwind styles apply correctly"
    status: "pending"

  - id: "MOBILE-02"
    name: "Implement Core UI Components"
    description: |
      Build reusable mobile UI components:
      - Button (primary, secondary, disabled states)
      - Input (text, email, password with validation)
      - Card (container for content)
      - List items (with icons, actions)
      - Loading indicators (spinner, skeleton)
      - Error/Empty states
      - Bottom Sheet (if needed)
      - All components with TypeScript types
    agent: "mobile-developer"
    depends_on: ["MOBILE-01"]
    consumes:
      - name: "Mobile App"
        required_from_task: "MOBILE-01"
      - name: "Mobile Design System"
        required_from_task: "DESIGN-01"
    produces:
      - name: "UI Components"
        type: "directory"
        path: "products/{PRODUCT}/apps/mobile/components/ui"
      - name: "Component Tests"
        type: "directory"
        path: "products/{PRODUCT}/apps/mobile/components/ui/__tests__"
    parallel_ok: false
    checkpoint: false
    priority: "high"
    estimated_time_minutes: 120
    acceptance_criteria:
      - "All core components implemented"
      - "Components are responsive"
      - "TypeScript types defined for all props"
      - "Each component has at least 2 tests"
      - "Components work on both iOS and Android"
    status: "pending"

  - id: "MOBILE-03"
    name: "Implement Navigation and Layouts"
    description: |
      Setup app navigation structure:
      - Tab navigation (if applicable)
      - Stack navigation for screens
      - Modal screens
      - Drawer navigation (if applicable)
      - Root layout with SafeAreaView
      - Screen headers and titles
      - Back button handling
      - Deep linking configuration
    agent: "mobile-developer"
    depends_on: ["MOBILE-02"]
    consumes:
      - name: "Mobile App"
        required_from_task: "MOBILE-01"
      - name: "Mobile Architecture Document"
        required_from_task: "ARCH-01"
    produces:
      - name: "Navigation Structure"
        type: "directory"
        path: "products/{PRODUCT}/apps/mobile/app"
      - name: "Layout Components"
        type: "directory"
        path: "products/{PRODUCT}/apps/mobile/components/layout"
    parallel_ok: false
    checkpoint: false
    priority: "high"
    estimated_time_minutes: 90
    acceptance_criteria:
      - "Navigation flows match design"
      - "Back button works correctly"
      - "Tab bar icons display correctly"
      - "Safe areas respected on all screens"
      - "Navigation tested on both platforms"
    status: "pending"

  - id: "MOBILE-04"
    name: "Implement State Management"
    description: |
      Setup state management with Zustand:
      - Auth store (user, token, login/logout)
      - App settings store (theme, preferences)
      - Data stores (for main entities)
      - Persistence with AsyncStorage
      - API client with token injection
      - Error handling patterns
    agent: "mobile-developer"
    depends_on: ["MOBILE-01"]
    consumes:
      - name: "Mobile App"
        required_from_task: "MOBILE-01"
    produces:
      - name: "Stores"
        type: "directory"
        path: "products/{PRODUCT}/apps/mobile/stores"
      - name: "API Client"
        type: "file"
        path: "products/{PRODUCT}/apps/mobile/lib/api.ts"
    parallel_ok: true
    checkpoint: false
    priority: "high"
    estimated_time_minutes: 90
    acceptance_criteria:
      - "Auth store persists across app restarts"
      - "API client includes auth tokens"
      - "Error handling works globally"
      - "State updates trigger re-renders"
      - "TypeScript types for all stores"
    status: "pending"

  - id: "MOBILE-05"
    name: "Implement MVP Features"
    description: |
      Build core MVP features:
      - All screens from design
      - Forms with validation (react-hook-form + zod)
      - API integration (TanStack Query)
      - Loading states
      - Error states
      - Empty states
      - Pull-to-refresh (where applicable)
      - Keyboard handling
    agent: "mobile-developer"
    depends_on: ["MOBILE-03", "MOBILE-04"]
    consumes:
      - name: "Mobile App"
        required_from_task: "MOBILE-01"
      - name: "UI Components"
        required_from_task: "MOBILE-02"
      - name: "Navigation Structure"
        required_from_task: "MOBILE-03"
      - name: "Stores"
        required_from_task: "MOBILE-04"
    produces:
      - name: "Feature Screens"
        type: "directory"
        path: "products/{PRODUCT}/apps/mobile/app"
      - name: "Feature Tests"
        type: "directory"
        path: "products/{PRODUCT}/apps/mobile/__tests__"
    parallel_ok: false
    checkpoint: false
    priority: "critical"
    estimated_time_minutes: 300
    acceptance_criteria:
      - "All MVP screens implemented"
      - "Forms validate correctly"
      - "API calls work"
      - "Loading states display"
      - "Errors handled gracefully"
      - "Keyboard doesn't cover inputs"
    status: "pending"

  - id: "MOBILE-06"
    name: "Implement Native Features"
    description: |
      Add native functionality (if required by PRD):
      - Push notifications (expo-notifications)
      - Camera/ImagePicker (expo-image-picker)
      - Location services (expo-location)
      - Biometric authentication (expo-local-authentication)
      - File system access (expo-file-system)
      - Handle permissions properly
      - Test on physical devices
    agent: "mobile-developer"
    depends_on: ["MOBILE-05"]
    consumes:
      - name: "Mobile PRD"
        required_from_task: "PRD-01"
      - name: "Mobile App"
        required_from_task: "MOBILE-01"
    produces:
      - name: "Native Features"
        type: "directory"
        path: "products/{PRODUCT}/apps/mobile/features"
    parallel_ok: false
    checkpoint: false
    priority: "high"
    estimated_time_minutes: 120
    acceptance_criteria:
      - "All required native features work"
      - "Permissions requested with explanations"
      - "Graceful degradation if permission denied"
      - "Tested on real iOS and Android devices"
    status: "pending"

  # ============================================================================
  # PHASE 4: BUILD & DEPLOYMENT SETUP
  # ============================================================================

  - id: "DEVOPS-01"
    name: "Setup EAS Build Configuration"
    description: |
      Configure EAS Build and Submit:
      - Create eas.json with build profiles
      - Configure development builds (with dev client)
      - Configure preview builds (internal testing)
      - Configure production builds (app stores)
      - Setup environment variables
      - Configure app credentials (bundle IDs, certificates)
      - Document build process
    agent: "devops-engineer"
    depends_on: ["MOBILE-06"]
    consumes:
      - name: "Mobile App"
        required_from_task: "MOBILE-01"
    produces:
      - name: "EAS Config"
        type: "file"
        path: "products/{PRODUCT}/apps/mobile/eas.json"
      - name: "Build Guide"
        type: "document"
        path: "products/{PRODUCT}/docs/BUILD.md"
    parallel_ok: false
    checkpoint: false
    priority: "high"
    estimated_time_minutes: 90
    acceptance_criteria:
      - "eas.json configured correctly"
      - "Development build succeeds"
      - "Environment variables documented"
      - "Build guide is clear"
    status: "pending"

  - id: "DEVOPS-02"
    name: "Create Development Builds"
    description: |
      Build development versions for testing:
      - Run EAS Build for development profile
      - Build for iOS (if {PLATFORMS} includes ios)
      - Build for Android (if {PLATFORMS} includes android)
      - Distribute to team for testing
      - Document installation process
    agent: "devops-engineer"
    depends_on: ["DEVOPS-01"]
    consumes:
      - name: "Mobile App"
        required_from_task: "MOBILE-01"
      - name: "EAS Config"
        required_from_task: "DEVOPS-01"
    produces:
      - name: "Development Builds"
        type: "artifact"
        path: "EAS Cloud"
    parallel_ok: false
    checkpoint: false
    priority: "high"
    estimated_time_minutes: 60
    acceptance_criteria:
      - "iOS development build available (if applicable)"
      - "Android development build available (if applicable)"
      - "Builds install on test devices"
      - "App runs on physical devices"
    status: "pending"

  # ============================================================================
  # PHASE 5: TESTING
  # ============================================================================

  - id: "QA-01"
    name: "Write Mobile Tests"
    description: |
      Create comprehensive test suite:
      - Unit tests for components (React Native Testing Library)
      - Unit tests for hooks and utilities
      - Integration tests for screens
      - Test user flows
      - Test form validation
      - Test API integration (mock API calls)
      - Aim for 80%+ coverage
    agent: "qa-engineer"
    depends_on: ["MOBILE-06"]
    consumes:
      - name: "Mobile App"
        required_from_task: "MOBILE-01"
      - name: "Feature Screens"
        required_from_task: "MOBILE-05"
    produces:
      - name: "Test Suite"
        type: "directory"
        path: "products/{PRODUCT}/apps/mobile/__tests__"
      - name: "Test Report"
        type: "document"
        path: "products/{PRODUCT}/docs/test-reports/mobile-tests.md"
    parallel_ok: true
    checkpoint: false
    priority: "critical"
    estimated_time_minutes: 180
    acceptance_criteria:
      - "All screens have tests"
      - "All components have tests"
      - "Test coverage > 80%"
      - "All tests pass on iOS and Android"
      - "Test report generated"
    status: "pending"

  - id: "QA-02"
    name: "Device Testing - iOS"
    description: |
      Test on iOS devices (if {PLATFORMS} includes ios):
      - Test on multiple iPhone models (SE, 13, 14 Pro)
      - Test on iPads (if supported)
      - Test all user flows
      - Test offline mode
      - Test push notifications
      - Test native features (camera, location, etc.)
      - Document any iOS-specific issues
    agent: "qa-engineer"
    depends_on: ["DEVOPS-02", "QA-01"]
    consumes:
      - name: "Development Builds"
        required_from_task: "DEVOPS-02"
    produces:
      - name: "iOS Test Report"
        type: "document"
        path: "products/{PRODUCT}/docs/test-reports/ios-device-testing.md"
    parallel_ok: true
    checkpoint: false
    priority: "critical"
    estimated_time_minutes: 120
    acceptance_criteria:
      - "Tested on at least 2 iPhone models"
      - "All features work on iOS"
      - "No critical bugs found"
      - "Performance is acceptable"
      - "Test report documents findings"
    status: "pending"

  - id: "QA-03"
    name: "Device Testing - Android"
    description: |
      Test on Android devices (if {PLATFORMS} includes android):
      - Test on multiple Android devices (Pixel, Samsung, OnePlus)
      - Test on different Android versions (10, 11, 12, 13)
      - Test all user flows
      - Test offline mode
      - Test push notifications
      - Test native features (camera, location, etc.)
      - Document any Android-specific issues
    agent: "qa-engineer"
    depends_on: ["DEVOPS-02", "QA-01"]
    consumes:
      - name: "Development Builds"
        required_from_task: "DEVOPS-02"
    produces:
      - name: "Android Test Report"
        type: "document"
        path: "products/{PRODUCT}/docs/test-reports/android-device-testing.md"
    parallel_ok: true
    checkpoint: false
    priority: "critical"
    estimated_time_minutes: 120
    acceptance_criteria:
      - "Tested on at least 2 Android devices"
      - "All features work on Android"
      - "No critical bugs found"
      - "Performance is acceptable"
      - "Test report documents findings"
    status: "pending"

  # ============================================================================
  # PHASE 6: DOCUMENTATION
  # ============================================================================

  - id: "DOCS-01"
    name: "Create Mobile Documentation"
    description: |
      Document the mobile app:
      - README with setup instructions
      - User manual (how to use the app)
      - Technical manual (architecture, building, deploying)
      - API integration guide
      - Troubleshooting guide
      - App store listing preparation (descriptions, screenshots)
    agent: "technical-writer"
    depends_on: ["MOBILE-06", "DEVOPS-01"]
    consumes:
      - name: "Mobile App"
        required_from_task: "MOBILE-01"
      - name: "Mobile Architecture Document"
        required_from_task: "ARCH-01"
    produces:
      - name: "README"
        type: "file"
        path: "products/{PRODUCT}/README.md"
      - name: "User Manual"
        type: "document"
        path: "products/{PRODUCT}/docs/{PRODUCT}-mobile-user-manual.md"
      - name: "Technical Manual"
        type: "document"
        path: "products/{PRODUCT}/docs/{PRODUCT}-mobile-technical-manual.md"
      - name: "App Store Listing"
        type: "document"
        path: "products/{PRODUCT}/docs/app-store-listing.md"
    parallel_ok: true
    checkpoint: false
    priority: "normal"
    estimated_time_minutes: 120
    acceptance_criteria:
      - "README has clear setup instructions"
      - "User manual explains all features"
      - "Technical manual covers architecture"
      - "App store descriptions ready"
      - "Screenshots prepared"
    status: "pending"

  # ============================================================================
  # CHECKPOINT: MOBILE MVP COMPLETE
  # ============================================================================

  - id: "CHECKPOINT-MVP"
    name: "Mobile MVP Complete - CEO Review"
    description: |
      Mobile app MVP is complete and tested. Ready for CEO to review:
      - App runs on iOS (if applicable)
      - App runs on Android (if applicable)
      - All MVP features implemented
      - All tests passing
      - Documentation complete
      - Ready for internal beta testing

      CEO can now test the app on physical devices before app store submission.
    agent: "orchestrator"
    depends_on: ["QA-02", "QA-03", "DOCS-01"]
    parallel_ok: false
    checkpoint: true
    priority: "critical"
    estimated_time_minutes: 0
    status: "pending"

# Execution estimates:
# - Sequential time: ~1,800 minutes (~30 hours)
# - Parallel optimized: ~1,200 minutes (~20 hours)
# - Savings from parallelization: ~33%
