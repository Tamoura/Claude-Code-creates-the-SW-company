{
  "agent": "performance-engineer",
  "version": "1.2.0",
  "updated_at": "2026-02-18T10:00:00Z",
  "learned_patterns": [
    {
      "pattern_id": "PE-PATTERN-001",
      "description": "N+1 query detection: look for Prisma findMany inside forEach — always use include or select with nested data instead",
      "first_applied": "2026-01-30",
      "products_applied": ["stablecoin-gateway", "muaththir"],
      "confidence": "high",
      "notes": "Found webhook delivery loop doing N individual transaction lookups. Replaced with single query using include. Reduced latency from 1200ms to 45ms on 50 webhooks."
    },
    {
      "pattern_id": "PE-PATTERN-002",
      "description": "Bundle size budget: set limit in vite.config.ts build.rollupOptions.output.manualChunks to enforce code splitting",
      "first_applied": "2026-02-03",
      "products_applied": ["stablecoin-gateway"],
      "confidence": "high",
      "notes": "stablecoin-gateway web bundle was 890KB (gzipped). After code splitting vendor chunks and lazy loading routes, reduced to 340KB. Target: <500KB gzipped."
    },
    {
      "pattern_id": "PE-PATTERN-003",
      "description": "Redis caching for expensive repeated queries: user profile, API key lookup, permission checks",
      "first_applied": "2026-02-05",
      "products_applied": ["stablecoin-gateway", "recomengine"],
      "confidence": "high",
      "notes": "API key lookup was hitting DB on every authenticated request. After Redis cache (TTL: 300s), P50 auth latency dropped from 85ms to 3ms."
    },
    {
      "pattern_id": "PE-PATTERN-004",
      "description": "Lighthouse CI: integrate in GitHub Actions to catch regressions automatically (fail if Performance < 80)",
      "first_applied": "2026-02-10",
      "products_applied": ["muaththir", "taskflow"],
      "confidence": "medium",
      "notes": "Manual Lighthouse runs are unreliable — engineers forget. Automated Lighthouse in CI caught a 35-point performance regression from an unoptimized image."
    }
  ],
  "task_history": [
    {
      "task_id": "PE-01",
      "product": "stablecoin-gateway",
      "task_type": "performance-audit",
      "started_at": "2026-01-30T09:00:00Z",
      "completed_at": "2026-01-30T15:00:00Z",
      "estimated_minutes": 240,
      "actual_minutes": 360,
      "status": "success",
      "baseline_metrics": {
        "api_p50_ms": 185,
        "api_p95_ms": 820,
        "bundle_kb_gzipped": 890,
        "lighthouse_performance": 62
      },
      "optimized_metrics": {
        "api_p50_ms": 45,
        "api_p95_ms": 120,
        "bundle_kb_gzipped": 340,
        "lighthouse_performance": 94
      },
      "optimizations_applied": [
        "N+1 query fix in webhook delivery",
        "Redis caching for API key lookups",
        "Code splitting with manual chunks",
        "Image optimization with next/image"
      ]
    },
    {
      "task_id": "PE-02",
      "product": "muaththir",
      "task_type": "database-optimization",
      "started_at": "2026-02-10T10:00:00Z",
      "completed_at": "2026-02-10T13:00:00Z",
      "estimated_minutes": 180,
      "actual_minutes": 180,
      "status": "success",
      "optimizations_applied": [
        "Added BRIN index on observations.created_at",
        "Composite index on (childId, createdAt) for observation queries",
        "Query analysis with EXPLAIN ANALYZE on 5 slow queries"
      ]
    }
  ],
  "common_mistakes": [
    {
      "mistake": "Optimizing without baseline measurement — cannot prove improvement",
      "occurred": 1,
      "last_occurrence": "2026-01-28",
      "impact": "Optimization effort produced unknown ROI — no baseline to compare against",
      "prevention": "Always capture baseline metrics BEFORE optimization: P50/P95 latency, bundle size, Lighthouse scores",
      "checklist_item": "Have I recorded baseline metrics before starting optimization?"
    },
    {
      "mistake": "Over-caching: applying Redis cache to data that changes frequently",
      "occurred": 1,
      "last_occurrence": "2026-02-06",
      "impact": "User profile cache served stale data after password change for 300 seconds",
      "prevention": "Cache invalidation strategy required for every cached entity. When does this data change? How do we invalidate?",
      "checklist_item": "What is the cache invalidation strategy for this cached entity?"
    }
  ],
  "preferred_approaches": [
    {
      "scenario": "Performance audit of an existing product",
      "approach": "1) Measure baseline (API P50/P95, bundle size, Lighthouse). 2) Profile DB queries (EXPLAIN ANALYZE). 3) Profile bundle (rollup-plugin-analyzer). 4) Apply optimizations in order of impact. 5) Measure again.",
      "reason": "Data-driven optimization prevents wasting time on low-impact changes",
      "example": "stablecoin-gateway audit: DB fix gave 4x improvement, bundle splitting gave 2.6x — DB first was the right priority"
    },
    {
      "scenario": "Setting up performance monitoring for a new product",
      "approach": "Add Lighthouse CI to GitHub Actions. Add API response time logging (P50, P95). Set bundle size limits in build config.",
      "reason": "Performance monitoring prevents regression — you will not notice gradual degradation without alerts",
      "example": "Lighthouse CI caught a 35-point regression in muaththir from an unoptimized image import"
    }
  ],
  "efficiency_improvements": [
    {
      "area": "Database query profiling",
      "old_approach": "Manual EXPLAIN ANALYZE on individual queries",
      "new_approach": "pg_stat_statements extension to identify slow queries automatically, then EXPLAIN ANALYZE the top offenders",
      "time_saved_minutes": 60,
      "first_used": "2026-02-10"
    }
  ],
  "performance_metrics": {
    "tasks_completed": 2,
    "success_rate": 1.0,
    "average_time_minutes": 270,
    "median_time_minutes": 270,
    "on_time_delivery": 0.9,
    "api_latency_improvements": "4x average",
    "bundle_size_reductions": "62% average",
    "lighthouse_improvements": "32 points average"
  }
}
