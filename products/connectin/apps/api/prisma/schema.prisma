generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ─── Enums ──────────────────────────────────────────────────

enum UserRole {
  USER
  RECRUITER
  ADMIN
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  DEACTIVATED
  DELETED
}

enum LanguagePreference {
  AR
  EN
}

enum ConnectionStatus {
  PENDING
  ACCEPTED
  REJECTED
  WITHDRAWN
  EXPIRED
}

enum TextDirection {
  RTL
  LTR
  AUTO
}

enum ThemePreference {
  LIGHT
  DARK
  SYSTEM
}

enum OpenToWorkVisibility {
  PUBLIC
  RECRUITERS_ONLY
}

enum MediaType {
  IMAGE
  VIDEO
  DOCUMENT
}

enum MediaStatus {
  PROCESSING
  READY
  FAILED
}

// ─── Users ──────────────────────────────────────────────────

model User {
  id                  String              @id @default(uuid())
  email               String              @unique
  passwordHash        String?             @map("password_hash")
  displayName         String              @map("display_name")
  role                UserRole            @default(USER)
  emailVerified       Boolean             @default(false) @map("email_verified")
  verificationToken   String?             @map("verification_token")
  verificationExpires DateTime?           @map("verification_expires")
  resetToken              String?             @map("reset_token")
  resetTokenExpires       DateTime?           @map("reset_token_expires")
  processingRestricted    Boolean             @default(false) @map("processing_restricted")
  processingRestrictedAt  DateTime?           @map("processing_restricted_at")
  objectionRegistered     Boolean             @default(false) @map("objection_registered")
  objectionRegisteredAt   DateTime?           @map("objection_registered_at")
  languagePreference      LanguagePreference  @default(AR) @map("language_preference")
  status              UserStatus          @default(ACTIVE)
  failedLoginAttempts Int                 @default(0) @map("failed_login_attempts")
  lockedUntil         DateTime?           @map("locked_until")
  isRestricted        Boolean             @default(false) @map("is_restricted")
  restrictedAt        DateTime?           @map("restricted_at")
  lastLoginAt         DateTime?           @map("last_login_at")
  createdAt           DateTime            @default(now()) @map("created_at")
  updatedAt           DateTime            @updatedAt @map("updated_at")

  profile             Profile?
  sessions            Session[]
  sentConnections     Connection[]        @relation("ConnectionSender")
  receivedConnections Connection[]        @relation("ConnectionReceiver")
  posts               Post[]
  comments            Comment[]
  likes               Like[]
  consents            Consent[]
  jobs                Job[]
  applications        JobApplication[]
  savedJobs           SavedJob[]
  conversationMemberships ConversationMember[]
  sentMessages            Message[]
  notifications           Notification[]
  notificationPreference  NotificationPreference?
  processingObjections    ProcessingObjection[]
  preference              UserPreference?
  reactions               Reaction[]
  blocksGiven             Block[]             @relation("BlocksGiven")
  blocksReceived          Block[]             @relation("BlocksReceived")
  reports                 Report[]
  followsGiven            Follow[]            @relation("FollowsGiven")
  followsReceived         Follow[]            @relation("FollowsReceived")
  endorsements            Endorsement[]
  reposts                 Repost[]
  mentions                Mention[]        @relation("MentionTarget")
  hashtagFollows          HashtagFollow[]
  media                   Media[]
  bookmarks               Bookmark[]
  profileViewsGiven       ProfileView[]   @relation("ProfileViewer")
  profileViewsReceived    ProfileView[]   @relation("ProfileViewed")
  recommendationsGiven    Recommendation[] @relation("RecommendationsGiven")
  recommendationsReceived Recommendation[] @relation("RecommendationsReceived")
  jobAlerts               JobAlert[]

  @@index([status, createdAt])
  @@index([verificationToken])
  @@map("users")
}

// ─── Processing Objections (GDPR Art 21) ─────────────────────

enum ObjectionType {
  PROFILING
  MARKETING
  ANALYTICS
}

model ProcessingObjection {
  id          String        @id @default(uuid())
  userId      String        @map("user_id")
  type        ObjectionType
  reason      String?       @db.VarChar(500)
  ipAddress   String?       @map("ip_address")
  userAgent   String?       @map("user_agent")
  objectedAt  DateTime      @default(now()) @map("objected_at")
  withdrawnAt DateTime?     @map("withdrawn_at")
  createdAt   DateTime      @default(now()) @map("created_at")

  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, type])
  @@index([userId])
  @@map("processing_objections")
}

// ─── Profiles ───────────────────────────────────────────────

model Profile {
  id                String          @id @default(uuid())
  userId            String          @unique @map("user_id")
  headlineAr        String?         @map("headline_ar") @db.VarChar(220)
  headlineEn        String?         @map("headline_en") @db.VarChar(220)
  summaryAr         String?         @map("summary_ar")
  summaryEn         String?         @map("summary_en")
  avatarUrl         String?         @map("avatar_url") @db.VarChar(500)
  bannerUrl         String?         @map("banner_url") @db.VarChar(500)
  slug              String?         @unique @db.VarChar(50)
  location          String?         @db.VarChar(100)
  website           String?         @db.VarChar(255)
  completenessScore Int             @default(0) @map("completeness_score")
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @updatedAt @map("updated_at")

  user              User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  experiences       Experience[]
  educations        Education[]
  profileSkills     ProfileSkill[]
  certifications    Certification[]

  @@map("profiles")
}

// ─── User Preferences ──────────────────────────────────────

model UserPreference {
  id                    String               @id @default(uuid())
  userId                String               @unique @map("user_id")
  theme                 ThemePreference      @default(SYSTEM)
  openToWork            Boolean              @default(false) @map("open_to_work")
  openToWorkVisibility  OpenToWorkVisibility @default(RECRUITERS_ONLY) @map("open_to_work_visibility")
  createdAt             DateTime             @default(now()) @map("created_at")
  updatedAt             DateTime             @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_preferences")
}

// ─── Experiences ────────────────────────────────────────────

model Experience {
  id          String    @id @default(uuid())
  profileId   String    @map("profile_id")
  company     String    @db.VarChar(200)
  title       String    @db.VarChar(200)
  location    String?   @db.VarChar(100)
  description String?
  startDate   DateTime  @map("start_date") @db.Date
  endDate     DateTime? @map("end_date") @db.Date
  isCurrent   Boolean   @default(false) @map("is_current")
  sortOrder   Int       @default(0) @map("sort_order")
  createdAt   DateTime  @default(now()) @map("created_at")

  profile     Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@map("experiences")
}

// ─── Education ──────────────────────────────────────────────

model Education {
  id           String    @id @default(uuid())
  profileId    String    @map("profile_id")
  institution  String    @db.VarChar(200)
  degree       String    @db.VarChar(200)
  fieldOfStudy String?   @map("field_of_study") @db.VarChar(200)
  description  String?
  startYear    Int       @map("start_year")
  endYear      Int?      @map("end_year")
  sortOrder    Int       @default(0) @map("sort_order")
  createdAt    DateTime  @default(now()) @map("created_at")

  profile      Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@map("educations")
}

// ─── Skills ─────────────────────────────────────────────────

model Skill {
  id        String         @id @default(uuid())
  nameEn    String         @unique @map("name_en") @db.VarChar(100)
  nameAr    String?        @map("name_ar") @db.VarChar(100)
  category  String?        @db.VarChar(50)
  createdAt DateTime       @default(now()) @map("created_at")

  profileSkills ProfileSkill[]

  @@map("skills")
}

model ProfileSkill {
  id               String   @id @default(uuid())
  profileId        String   @map("profile_id")
  skillId          String   @map("skill_id")
  endorsementCount Int      @default(0) @map("endorsement_count")
  createdAt        DateTime @default(now()) @map("created_at")

  profile          Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  skill            Skill    @relation(fields: [skillId], references: [id], onDelete: Cascade)
  endorsements     Endorsement[]

  @@unique([profileId, skillId])
  @@map("profile_skills")
}

// ─── Connections ────────────────────────────────────────────

model Connection {
  id            String           @id @default(uuid())
  senderId      String           @map("sender_id")
  receiverId    String           @map("receiver_id")
  status        ConnectionStatus @default(PENDING)
  message       String?          @db.VarChar(300)
  respondedAt   DateTime?        @map("responded_at")
  cooldownUntil DateTime?        @map("cooldown_until")
  expiresAt     DateTime?        @map("expires_at")
  createdAt     DateTime         @default(now()) @map("created_at")

  sender        User             @relation("ConnectionSender", fields: [senderId], references: [id], onDelete: Cascade)
  receiver      User             @relation("ConnectionReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId])
  @@index([senderId, status])
  @@index([receiverId, status])
  @@index([status, expiresAt])
  @@map("connections")
}

// ─── Sessions ───────────────────────────────────────────────

model Session {
  id               String   @id @default(uuid())
  userId           String   @map("user_id")
  refreshTokenHash String   @map("refresh_token_hash")
  ipAddress        String?  @map("ip_address")
  userAgent        String?  @map("user_agent")
  expiresAt        DateTime @map("expires_at")
  createdAt        DateTime @default(now()) @map("created_at")

  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([refreshTokenHash])
  @@map("sessions")
}

// ─── Posts ───────────────────────────────────────────────────

model Post {
  id            String        @id @default(uuid())
  authorId      String        @map("author_id")
  content       String        @db.VarChar(3000)
  textDirection TextDirection @default(AUTO) @map("text_direction")
  likeCount     Int           @default(0) @map("like_count")
  commentCount  Int           @default(0) @map("comment_count")
  isDeleted     Boolean       @default(false) @map("is_deleted")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  repostCount   Int           @default(0) @map("repost_count")

  author        User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  comments      Comment[]
  likes         Like[]
  reactions     Reaction[]
  reposts       Repost[]
  postHashtags  PostHashtag[]
  mentions      Mention[]
  postMedia     PostMedia[]
  bookmarks     Bookmark[]
  poll          Poll?
  postViews     PostView[]

  @@index([authorId, createdAt(sort: Desc)])
  @@index([createdAt(sort: Desc)])
  @@map("posts")
}

// ─── Comments ───────────────────────────────────────────────

model Comment {
  id            String        @id @default(uuid())
  postId        String        @map("post_id")
  authorId      String        @map("author_id")
  content       String        @db.VarChar(1000)
  textDirection TextDirection @default(AUTO) @map("text_direction")
  isDeleted     Boolean       @default(false) @map("is_deleted")
  createdAt     DateTime      @default(now()) @map("created_at")

  post          Post          @relation(fields: [postId], references: [id], onDelete: Cascade)
  author        User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  mentions      Mention[]

  @@index([postId, createdAt(sort: Desc)])
  @@map("comments")
}

// ─── Consents ─────────────────────────────────────────────────

enum ConsentType {
  TERMS_OF_SERVICE
  PRIVACY_POLICY
  MARKETING_EMAIL
  DATA_PROCESSING
  ANALYTICS
}

model Consent {
  id          String      @id @default(uuid())
  userId      String      @map("user_id")
  type        ConsentType
  granted     Boolean     @default(false)
  version     String      @db.VarChar(20)
  ipAddress   String?     @map("ip_address")
  userAgent   String?     @map("user_agent")
  grantedAt   DateTime?   @map("granted_at")
  revokedAt   DateTime?   @map("revoked_at")
  createdAt   DateTime    @default(now()) @map("created_at")

  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, type])
  @@index([userId])
  @@map("consents")
}

// ─── Likes ──────────────────────────────────────────────────

model Like {
  id        String   @id @default(uuid())
  postId    String   @map("post_id")
  userId    String   @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")

  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
  @@map("likes")
}

// ─── Jobs ────────────────────────────────────────────────────

enum WorkType {
  ONSITE
  HYBRID
  REMOTE
}

enum ExperienceLevel {
  ENTRY
  MID
  SENIOR
  LEAD
  EXECUTIVE
}

enum JobStatus {
  OPEN
  CLOSED
  ARCHIVED
}

enum ApplicationStatus {
  PENDING
  REVIEWED
  SHORTLISTED
  REJECTED
  WITHDRAWN
}

model Job {
  id               String          @id @default(uuid())
  recruiterId      String          @map("recruiter_id")
  title            String          @db.VarChar(200)
  company          String          @db.VarChar(200)
  location         String?         @db.VarChar(200)
  workType         WorkType        @default(ONSITE) @map("work_type")
  experienceLevel  ExperienceLevel @default(MID) @map("experience_level")
  description      String          @db.Text
  requirements     String?         @db.Text
  salaryMin        Decimal?        @map("salary_min") @db.Decimal(12, 2)
  salaryMax        Decimal?        @map("salary_max") @db.Decimal(12, 2)
  salaryCurrency   String?         @default("USD") @map("salary_currency") @db.VarChar(10)
  language         String          @default("en") @db.VarChar(5)
  status           JobStatus       @default(OPEN)
  applicantCount   Int             @default(0) @map("applicant_count")
  createdAt        DateTime        @default(now()) @map("created_at")
  updatedAt        DateTime        @updatedAt @map("updated_at")

  recruiter        User            @relation(fields: [recruiterId], references: [id], onDelete: Cascade)
  applications     JobApplication[]
  savedBy          SavedJob[]
  bookmarks        Bookmark[]

  @@index([recruiterId])
  @@index([status, createdAt])
  @@index([workType])
  @@index([experienceLevel])
  @@map("jobs")
}

model JobApplication {
  id          String            @id @default(uuid())
  jobId       String            @map("job_id")
  applicantId String            @map("applicant_id")
  coverNote   String?           @db.VarChar(500) @map("cover_note")
  status      ApplicationStatus @default(PENDING)
  appliedAt   DateTime          @default(now()) @map("applied_at")
  updatedAt   DateTime          @updatedAt @map("updated_at")

  job         Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  applicant   User              @relation(fields: [applicantId], references: [id], onDelete: Cascade)

  @@unique([jobId, applicantId])
  @@index([applicantId])
  @@index([jobId])
  @@map("job_applications")
}

model SavedJob {
  id        String   @id @default(uuid())
  jobId     String   @map("job_id")
  userId    String   @map("user_id")
  savedAt   DateTime @default(now()) @map("saved_at")

  job       Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([jobId, userId])
  @@index([userId])
  @@map("saved_jobs")
}

// ─── Messaging ────────────────────────────────────────────────

model Conversation {
  id            String    @id @default(uuid())
  isGroup       Boolean   @default(false) @map("is_group")
  name          String?   @db.VarChar(100)
  adminId       String?   @map("admin_id")
  lastMessageAt DateTime? @map("last_message_at")
  createdAt     DateTime  @default(now()) @map("created_at")

  members  ConversationMember[]
  messages Message[]

  @@map("conversations")
}

model ConversationMember {
  id             String    @id @default(uuid())
  conversationId String    @map("conversation_id")
  userId         String    @map("user_id")
  lastReadAt     DateTime? @map("last_read_at")
  createdAt      DateTime  @default(now()) @map("created_at")

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@index([userId])
  @@map("conversation_members")
}

model Message {
  id             String    @id @default(uuid())
  conversationId String    @map("conversation_id")
  senderId       String    @map("sender_id")
  content        String    @db.Text
  isDeleted      Boolean   @default(false) @map("is_deleted")
  readAt         DateTime? @map("read_at")
  createdAt      DateTime  @default(now()) @map("created_at")

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender       User         @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([conversationId, createdAt(sort: Desc)])
  @@index([senderId])
  @@map("messages")
}

// ─── Notifications ────────────────────────────────────────────

enum NotificationType {
  CONNECTION_REQUEST
  CONNECTION_ACCEPTED
  MESSAGE
  POST_LIKE
  POST_COMMENT
  JOB_APPLICATION
  MENTION
  SYSTEM
}

enum EmailDigestFrequency {
  OFF
  DAILY
  WEEKLY
}

model Notification {
  id            String           @id @default(uuid())
  userId        String           @map("user_id")
  type          NotificationType
  title         String           @db.VarChar(200)
  message       String?          @db.Text
  referenceId   String?          @map("reference_id")
  referenceType String?          @map("reference_type") @db.VarChar(50)
  isRead        Boolean          @default(false) @map("is_read")
  readAt        DateTime?        @map("read_at")
  createdAt     DateTime         @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isRead, createdAt(sort: Desc)])
  @@map("notifications")
}

model NotificationPreference {
  id                 String               @id @default(uuid())
  userId             String               @unique @map("user_id")
  connectionRequests Boolean              @default(true) @map("connection_requests")
  messages           Boolean              @default(true)
  postLikes          Boolean              @default(true) @map("post_likes")
  postComments       Boolean              @default(true) @map("post_comments")
  jobRecommendations Boolean              @default(true) @map("job_recommendations")
  emailDigest        EmailDigestFrequency @default(WEEKLY) @map("email_digest")
  updatedAt          DateTime             @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notification_preferences")
}

// ─── Reactions (replaces Like for rich engagement) ──────────────

enum ReactionType {
  LIKE
  CELEBRATE
  SUPPORT
  LOVE
  INSIGHTFUL
  FUNNY
}

model Reaction {
  id        String       @id @default(uuid())
  postId    String       @map("post_id")
  userId    String       @map("user_id")
  type      ReactionType
  createdAt DateTime     @default(now()) @map("created_at")

  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
  @@index([postId])
  @@map("reactions")
}

// ─── Blocks ─────────────────────────────────────────────────────

model Block {
  id        String   @id @default(uuid())
  blockerId String   @map("blocker_id")
  blockedId String   @map("blocked_id")
  createdAt DateTime @default(now()) @map("created_at")

  blocker User @relation("BlocksGiven", fields: [blockerId], references: [id], onDelete: Cascade)
  blocked User @relation("BlocksReceived", fields: [blockedId], references: [id], onDelete: Cascade)

  @@unique([blockerId, blockedId])
  @@index([blockerId])
  @@index([blockedId])
  @@map("blocks")
}

// ─── Reports ────────────────────────────────────────────────────

enum ReportReason {
  SPAM
  HARASSMENT
  HATE_SPEECH
  MISINFORMATION
  IMPERSONATION
  OTHER
}

enum ReportStatus {
  PENDING
  REVIEWED
  RESOLVED
  DISMISSED
}

enum ReportTargetType {
  USER
  POST
  COMMENT
}

model Report {
  id          String           @id @default(uuid())
  reporterId  String           @map("reporter_id")
  targetType  ReportTargetType @map("target_type")
  targetId    String           @map("target_id")
  reason      ReportReason
  description String?          @db.VarChar(1000)
  status      ReportStatus     @default(PENDING)
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")

  reporter User @relation(fields: [reporterId], references: [id], onDelete: Cascade)

  @@index([reporterId])
  @@index([targetType, targetId])
  @@map("reports")
}

// ─── Follows (non-connection) ───────────────────────────────────

model Follow {
  id         String   @id @default(uuid())
  followerId String   @map("follower_id")
  followingId String  @map("following_id")
  createdAt  DateTime @default(now()) @map("created_at")

  follower  User @relation("FollowsGiven", fields: [followerId], references: [id], onDelete: Cascade)
  following User @relation("FollowsReceived", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
  @@map("follows")
}

// ─── Hashtags ───────────────────────────────────────────────────

model Hashtag {
  id         String   @id @default(uuid())
  tag        String   @unique @db.VarChar(100)
  postCount  Int      @default(0) @map("post_count")
  isTrending Boolean  @default(false) @map("is_trending")
  createdAt  DateTime @default(now()) @map("created_at")

  postHashtags   PostHashtag[]
  hashtagFollows HashtagFollow[]

  @@index([postCount(sort: Desc)])
  @@map("hashtags")
}

model PostHashtag {
  id        String   @id @default(uuid())
  postId    String   @map("post_id")
  hashtagId String   @map("hashtag_id")
  createdAt DateTime @default(now()) @map("created_at")

  post    Post    @relation(fields: [postId], references: [id], onDelete: Cascade)
  hashtag Hashtag @relation(fields: [hashtagId], references: [id], onDelete: Cascade)

  @@unique([postId, hashtagId])
  @@map("post_hashtags")
}

model HashtagFollow {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  hashtagId String   @map("hashtag_id")
  createdAt DateTime @default(now()) @map("created_at")

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  hashtag Hashtag @relation(fields: [hashtagId], references: [id], onDelete: Cascade)

  @@unique([userId, hashtagId])
  @@map("hashtag_follows")
}

// ─── Mentions ───────────────────────────────────────────────────

model Mention {
  id              String   @id @default(uuid())
  postId          String?  @map("post_id")
  commentId       String?  @map("comment_id")
  mentionedUserId String   @map("mentioned_user_id")
  offsetStart     Int      @map("offset_start")
  offsetEnd       Int      @map("offset_end")
  createdAt       DateTime @default(now()) @map("created_at")

  post          Post?   @relation(fields: [postId], references: [id], onDelete: Cascade)
  comment       Comment? @relation(fields: [commentId], references: [id], onDelete: Cascade)
  mentionedUser User    @relation("MentionTarget", fields: [mentionedUserId], references: [id], onDelete: Cascade)

  @@index([mentionedUserId])
  @@index([postId])
  @@map("mentions")
}

// ─── Reposts ────────────────────────────────────────────────────

model Repost {
  id             String   @id @default(uuid())
  originalPostId String   @map("original_post_id")
  userId         String   @map("user_id")
  comment        String?  @db.VarChar(1000)
  createdAt      DateTime @default(now()) @map("created_at")

  originalPost Post @relation(fields: [originalPostId], references: [id], onDelete: Cascade)
  user         User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([originalPostId, userId])
  @@index([userId])
  @@map("reposts")
}

// ─── Media ───────────────────────────────────────────────────────

model Media {
  id            String      @id @default(uuid())
  uploaderId    String      @map("uploader_id")
  type          MediaType
  status        MediaStatus @default(PROCESSING)
  originalName  String      @map("original_name") @db.VarChar(255)
  mimeType      String      @map("mime_type") @db.VarChar(100)
  size          Int
  url           String      @db.VarChar(1000)
  thumbnailUrl  String?     @map("thumbnail_url") @db.VarChar(1000)
  width         Int?
  height        Int?
  altText       String?     @map("alt_text") @db.VarChar(500)
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")

  uploader      User        @relation(fields: [uploaderId], references: [id], onDelete: Cascade)
  postMedia     PostMedia[]

  @@index([uploaderId])
  @@index([status])
  @@map("media")
}

model PostMedia {
  id        String   @id @default(uuid())
  postId    String   @map("post_id")
  mediaId   String   @map("media_id")
  sortOrder Int      @default(0) @map("sort_order")
  createdAt DateTime @default(now()) @map("created_at")

  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  media     Media    @relation(fields: [mediaId], references: [id], onDelete: Cascade)

  @@unique([postId, mediaId])
  @@index([postId])
  @@map("post_media")
}

// ─── Endorsements ───────────────────────────────────────────────

model Endorsement {
  id             String       @id @default(uuid())
  endorserId     String       @map("endorser_id")
  profileSkillId String       @map("profile_skill_id")
  createdAt      DateTime     @default(now()) @map("created_at")

  endorser     User         @relation(fields: [endorserId], references: [id], onDelete: Cascade)
  profileSkill ProfileSkill @relation(fields: [profileSkillId], references: [id], onDelete: Cascade)

  @@unique([endorserId, profileSkillId])
  @@index([profileSkillId])
  @@map("endorsements")
}

// ─── Bookmarks ──────────────────────────────────────────────────

model Bookmark {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  postId    String?  @map("post_id")
  jobId     String?  @map("job_id")
  createdAt DateTime @default(now()) @map("created_at")

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  post      Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)
  job       Job?     @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@unique([userId, jobId])
  @@index([userId, createdAt(sort: Desc)])
  @@map("bookmarks")
}

// ─── Polls ─────────────────────────────────────────────────────

model Poll {
  id         String       @id @default(uuid())
  postId     String       @unique @map("post_id")
  question   String       @db.VarChar(300)
  endsAt     DateTime     @map("ends_at")
  totalVotes Int          @default(0) @map("total_votes")
  createdAt  DateTime     @default(now()) @map("created_at")

  post       Post         @relation(fields: [postId], references: [id], onDelete: Cascade)
  options    PollOption[]
  votes      PollVote[]

  @@index([endsAt])
  @@map("polls")
}

model PollOption {
  id        String     @id @default(uuid())
  pollId    String     @map("poll_id")
  text      String     @db.VarChar(100)
  voteCount Int        @default(0) @map("vote_count")
  sortOrder Int        @default(0) @map("sort_order")

  poll      Poll       @relation(fields: [pollId], references: [id], onDelete: Cascade)
  votes     PollVote[]

  @@index([pollId])
  @@map("poll_options")
}

model PollVote {
  id        String     @id @default(uuid())
  pollId    String     @map("poll_id")
  optionId  String     @map("option_id")
  userId    String     @map("user_id")
  createdAt DateTime   @default(now()) @map("created_at")

  poll      Poll       @relation(fields: [pollId], references: [id], onDelete: Cascade)
  option    PollOption @relation(fields: [optionId], references: [id], onDelete: Cascade)

  @@unique([pollId, userId])
  @@index([pollId])
  @@map("poll_votes")
}

// ─── Post Views (Content Analytics) ───────────────────────────

model PostView {
  id        String   @id @default(uuid())
  postId    String   @map("post_id")
  userId    String?  @map("user_id")
  viewedAt  DateTime @default(now()) @map("viewed_at")

  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId, viewedAt(sort: Desc)])
  @@index([userId])
  @@map("post_views")
}

// ─── Profile Views ──────────────────────────────────────────────

model ProfileView {
  id            String   @id @default(uuid())
  viewerId      String   @map("viewer_id")
  viewedUserId  String   @map("viewed_user_id")
  viewedAt      DateTime @default(now()) @map("viewed_at")

  viewer        User     @relation("ProfileViewer", fields: [viewerId], references: [id], onDelete: Cascade)
  viewedUser    User     @relation("ProfileViewed", fields: [viewedUserId], references: [id], onDelete: Cascade)

  @@index([viewedUserId, viewedAt(sort: Desc)])
  @@index([viewerId])
  @@map("profile_views")
}

// ─── Certifications ──────────────────────────────────────────

model Certification {
  id            String    @id @default(uuid())
  profileId     String    @map("profile_id")
  name          String    @db.VarChar(200)
  issuingOrg    String    @map("issuing_org") @db.VarChar(200)
  credentialId  String?   @map("credential_id") @db.VarChar(100)
  credentialUrl String?   @map("credential_url") @db.VarChar(500)
  issueDate     DateTime  @map("issue_date") @db.Date
  expiryDate    DateTime? @map("expiry_date") @db.Date
  createdAt     DateTime  @default(now()) @map("created_at")

  profile Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@map("certifications")
}

// ─── Recommendations ─────────────────────────────────────────

enum RecommendationStatus {
  PENDING
  ACCEPTED
  DECLINED
}

model Recommendation {
  id           String               @id @default(uuid())
  authorId     String               @map("author_id")
  recipientId  String               @map("recipient_id")
  content      String               @db.VarChar(3000)
  relationship String               @db.VarChar(200)
  status       RecommendationStatus @default(PENDING)
  createdAt    DateTime             @default(now()) @map("created_at")
  updatedAt    DateTime             @updatedAt @map("updated_at")

  author    User @relation("RecommendationsGiven", fields: [authorId], references: [id], onDelete: Cascade)
  recipient User @relation("RecommendationsReceived", fields: [recipientId], references: [id], onDelete: Cascade)

  @@unique([authorId, recipientId])
  @@index([recipientId, status])
  @@map("recommendations")
}

// ─── Job Alerts ──────────────────────────────────────────────

model JobAlert {
  id              String           @id @default(uuid())
  userId          String           @map("user_id")
  keywords        String?          @db.VarChar(500)
  location        String?          @db.VarChar(200)
  workType        WorkType?        @map("work_type")
  experienceLevel ExperienceLevel? @map("experience_level")
  isActive        Boolean          @default(true) @map("is_active")
  lastNotifiedAt  DateTime?        @map("last_notified_at")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isActive])
  @@map("job_alerts")
}
